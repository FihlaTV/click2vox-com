extends ../layout

block extra_head
  script.
    require([
      'angular',
      'jquery',
      'controllers/widget.list',
      'controllers/sip.edit',
    ],
    function(angular, $, WidgetListController, EditSIPController) {
      angular.module('voxboneApp', [])
        .controller('WidgetListController', WidgetListController)
        .controller('EditSIPController', EditSIPController);

      angular.bootstrap(document, ['voxboneApp']);

      $(document).on('hide.bs.collapse show.bs.collapse', '.sipCollapse', function () {
        var trigger = $('[data-toggle="collapse"][href="#' + $(this).attr('id') + '"]');
        trigger.find('i').toggleClass('glyphicon-chevron-down glyphicon-chevron-right');
      });

      $(document).on('click', '#callVoxbone', function () {
        $('.call-to-voxbone-button .vxb-widget-box #launch_call')[0].click();
      });
    });

block content
  .main.buttonList
    .header
      .container
        h1 Click2Vox Buttons
        p You will only be able to create buttons with a single user-defined SIP URI on a free account. #[a(href="#" data-toggle="modal" data-target="#myModal") Upgrade Now]

        .actions-wrap
          if process.env.BYPASS_ADDING_SIP_URI === 'false'
            if currentUser.sip_uris.length > 0 && !currentUser.paid
              #[a.btn.btn-purple(data-toggle="modal" data-target="#myModal") Add SIP URI]
            else
              #[a.btn.btn-purple(href="/sip/new") Add SIP URI]

          #[=" "] #[a.btn.btn-success(href="/widget/new") Add New Button]

    .body(ng-controller="WidgetListController")
      .container
        .row
          - each group in widgetsData
            .col-xs-12
              .group-header
                h4
                  a(data-toggle="collapse" href="##{group.uuid}" class="#{(group.widgets.length === 0) ? 'collapsed': ''}")
                    i(class="glyphicon glyphicon-chevron-#{(group.widgets.length === 0) ? 'right': 'down'}")
                    span #{group._id}
                .group-header-actions
                  a(href="#" ng-click='editSIPURI("#{group._id}")') Edit

              .sipCollapse.collapse.in(id="#{group.uuid}")
                if group.widgets.length > 0
                  table.table
                    thead
                      tr
                        td(width="25%") Configuration Name
                        td.text-center(width="55%") Button Preview
                        td.text-right Actions
                    tbody
                      - each widget in group.widgets
                        tr
                          td #{widget.configuration_name}
                          td.text-center
                            button(class="btn-#{widget.button_style}")
                              span #{widget.button_label || defaultBtnLabel}
                          td.text-right
                            #[button.btn.btn-sm.btn-primary.clipboard(widget-code="#{widget.divCode}") Copy Code] #[a.btn.btn-sm.btn-info(href="/widget/#{widget._id}/edit") View / Edit]

    include contact-voxbone
    include ../sip/edit_modal
