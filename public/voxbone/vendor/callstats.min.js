/*! callstats.js 2016-06-14 */
!function(a){"use strict";var b=function(a,b,c){function d(){}function e(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function f(){var a=g();return a+db.currentOffset}function g(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function h(){"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){xa=a})}function i(){return xa?xa.level:void 0}function j(){return xa?xa.charging:void 0}function k(){navigator.mediaDevices.enumerateDevices().then(function(a){wa=a})}function l(a){var b=a.toString();return null!==a.localDescription&&null!==a.localDescription.sdp&&a.localDescription.sdp.split("\r\n").filter(function(a){return 0===a.indexOf("o=")}).forEach(function(a){var d=a.split(" ")[1],e=new c(d,"TEXT");b=e.getHash("SHA-1","B64")}),b}function m(a){var b=new c(a,"TEXT");return b.getHash("SHA-1","B64")}function n(a,b){var c=l(a),d=l(b);return c===d}function o(a){var b=0;return null!==a.localDescription&&null!==a.localDescription.sdp&&""!==a.localDescription.sdp&&(b=a.localDescription.sdp.split("\r\n").filter(function(a){return 0===a.indexOf("o=")})),b.length}function p(){La||window.addEventListener("beforeunload",function(a){var b;for(b in bb)bb.hasOwnProperty(b)&&Vb(pb.userLeft,null,b,bb[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function q(a,b){setTimeout(function(){var b=f(),c=b-a.data.apiTS;a.data.timeShift=c,oa(a.type,a.action,a.data,a.callback)},b)}function r(a,b,c,d,e){var f=l(d);Vb(pb.mediaPlaybackStartEvent,b,c,a,{ssrc:e},f,null)}function s(a,b,c,d,e){var f=l(d);Vb(pb.mediaSuspendedEvent,b,c,a,{ssrc:e},f,null)}function t(a,b,c,d,e){var f=document.getElementById(c);if(f){var g=bb[b].ucID;f.oncanplay=function(){r(g,a,b,d,e)},f.onsuspend=function(){s(g,a,b,d,e)}}}function u(a){var b=$a.codebase,c=!1;return null===a?c=!1:b===Ib.firefox?"undefined"!=typeof mozRTCPeerConnection&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!=typeof RTCPeerConnection&&a instanceof RTCPeerConnection&&(c=!0):("function"==typeof a||a instanceof nb||b===Ib.edge)&&(c=!0),c}function v(a,b){var d,e;return a&&(b===Ib.chrome?(d=a.googLocalAddress,d.concat(":",a.googRemoteAddress)):b===Ib.firefox&&(d=a.localAddr,d.concat(":",a.remoteAddr))),e=new c(d,"TEXT"),e.getHash("SHA-1","B64")}function w(){var a;return a=navigator.onLine===!0?"online":"offline"}function x(a,b){var c=Jb.unknown,d=null;if(b===Ib.chrome)void 0!==a&&(void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?c=Jb.video:void 0===a.data.audioInputLevel&&void 0===a.data.audioOutputLevel||(c=Jb.audio),d=a.data.googCodecName);else{if(b!==Ib.firefox)return;void 0!==a&&(void 0!==a.data.mediaType?c=a.data.mediaType:void 0!==a.data.framerateMean&&(c=Jb.video))}return a.data.ssrc in fb&&(fb[a.data.ssrc].mediaType=c,fb[a.data.ssrc].codec=d),c}function y(a,b){return b===Ib.chrome&&void 0!==a.data.googCurrentDelayMs?a.data.googCurrentDelayMs:void 0}function z(a,b){var c;return b===Ib.chrome?void 0!==a.data.googFrameRateOutput?c=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?c=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?c=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(c=parseInt(a.data.googFrameRateSent,10)):b===Ib.firefox&&void 0!==a.data.framerateMean&&(c=parseInt(a.data.framerateMean,10)),void 0!==c&&(c=isNaN(c)||0>c?null:c),c}function A(a,b){var c="unavailable";if(b===Ib.chrome){var d,e,f;d=z(a,b),void 0!==a.data.googFrameWidthReceived?f=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(f=a.data.googFrameWidthSent),void 0!==a.data.googFrameHeightReceived?e=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent&&(e=a.data.googFrameHeightSent),void 0!==d&&void 0!==f&&void 0!==e&&f>0&&e>0&&(c=f.concat("x",e,"@",d))}else b===Ib.firefox;return c}function B(a){var b;return b=isNaN(a)||0>a?null:a}function C(a,b){var c;if(b===Ib.chrome){if(void 0!==a&&void 0!==a.data.googRtt)return c=B(parseInt(a.data.googRtt,10))}else if(b===Ib.firefox){if(void 0!==a&&void 0!==a.data.mozRtt)return c=B(parseInt(a.data.mozRtt,10))}else if(b===Ib.edge&&a&&a.data.roundTripTime)return c=B(parseInt(a.data.roundTripTime,10))}function D(a,b){var c;if(b===Ib.chrome){if(void 0!==a&&void 0!==a.data.googJitterReceived)return c=K(parseInt(a.data.googJitterReceived,10))}else if(b===Ib.firefox&&void 0!==a&&void 0!==a.data.jitter)return c=K(parseInt(a.data.jitter,10))}function E(a,b){if(b.sort(),b.length>0){var c=a/100*b.length;c=Math.ceil(c);var d=b[c-1];return d}}function F(a,b,c){var d;return b===Jb.audio?a<c.audio.gThreshold?d=yb.excellent:a>c.audio.gThreshold&&a<c.audio.rThreshold?d=yb.fair:a>c.audio.rThreshold&&(d=yb.bad):b===Jb.video&&(a<c.video.gThreshold?d=yb.excellent:a>c.video.gThreshold&&a<c.video.rThreshold?d=yb.fair:a>c.video.rThreshold&&(d=yb.bad)),d}function G(a,b,c){var d;return b===Jb.audio?a>c.audio.gThreshold?d=yb.excellent:a>c.audio.rThreshold&&a<c.audio.gThreshold?d=yb.fair:a<c.audio.rThreshold&&(d=yb.bad):b===Jb.video&&(a>c.video.gThreshold?d=yb.excellent:a>c.video.rThreshold&&a<c.video.gThreshold?d=yb.fair:a<c.video.rThreshold&&(d=yb.bad)),d}function H(){var a,b,c=0,d=0;for(a=0;a<arguments.length;a++)void 0!==arguments[a]&&null!==arguments[a]&&(c+=arguments[a],d++);return d>0&&(c/=d,c=Math.floor(c),c===yb.excellent?b=zb.excellent:c===yb.fair?b=zb.fair:c===yb.bad&&(b=zb.bad)),b}function I(a,b,c){var d,e,f,g,h,i,j,k,l,m=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(k={},h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k.hash=b[d].hash,l=c-g,l>0&&(k.receivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/l,k.sentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/l,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(k.sentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(l/1e3)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(k.receivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(l/1e3))),k.rtt=b[d].googRtt,m.push(k))}return m}function J(a,b,c,d){var e=[];return c===Ib.firefox?e=null:c===Ib.chrome&&(e=I(a,b,d)),e}function K(a){var b=isNaN(a)?null:a;return b}function L(a){if(a=K(a),null!==a){var b=0>a?null:a;return b}}function M(a,b,c,d,e,f,g){return void 0===a[c]&&(a[c]={}),void 0===a[c].streams&&(a[c].streams={}),void 0===a[c].streams[b]&&(a[c].streams[b]={}),void 0===a[c].streams[b][e]&&(a[c].streams[b][e]={}),void 0===a[c].streams[b][e][d]&&(a[c].streams[b][e][d]={}),void 0===a[c].streams[b][e][d].totalTimeMs&&(g?a[c].streams[b][e][d][f]=[]:a[c].streams[b][e][d][f]=0),a}function N(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,B,D,I,J,N=null,O=null,P=null,Q=null,R=null,S=null,T=null,U=null,V=null,W=null,X=null,Y=null;for(o in b.streams[c].outbound)if(b.streams[c].outbound.hasOwnProperty(o)){var Z=b.streams[c].outbound[o].data;if(void 0!==e.streams[c]&&void 0!==e.streams[c].outbound&&void 0!==e.streams[c].outbound[o]?(j=K(parseInt(e.streams[c].outbound[o].data.bytesSent,10)),k=a.lastStatsSent.apiTS,D=K(parseInt(e.streams[c].outbound[o].data.packetsSent,10)),J=K(parseInt(e.streams[c].outbound[o].data.packetsLost,10))):(j=0,k=g,J=0,D=0),m=g,u=m-k,p=x(b.streams[c].outbound[o],f),q=A(b.streams[c].outbound[o],f),r=z(b.streams[c].outbound[o],f),v=y(b.streams[c].outbound[o],f),void 0===d.streams[c]&&(d.streams[c]={}),void 0===d.streams[c].outbound&&(d.streams[c].outbound={}),d.streams[c].outbound[o]={},n=C(b.streams[c].outbound[o],f),l=K(parseInt(Z.bytesSent,10)),null!==l&&null!==j&&j>l&&(j=0,pc(Da,Ea,"log",{msg:"getstats: curBytesSent < prevBytesSent counter reset",conferenceID:h,ucID:i})),I=L(parseInt(Z.packetsLost,10)),null!==I&&null!==J&&(O=I-J),B=L(parseInt(Z.packetsSent,10)),null!==B&&null!==D&&(w=B-D),void 0!==O&&void 0!==w&&w+O>0&&(P=O/(w+O)),u>0&&(null!==l&&null!==j&&(N=8*(l-j)/u),void 0!==w&&(Y=w/(u/1e3))),a=M(a,c,"rttInfo",o,"outbound","rttArray",!0),a=M(a,c,"fractionalLossInfo",o,"outbound","fractionalLossArray",!0),a=M(a,c,"timeElapse",o,"outbound","totalTimeMs",!1),void 0!==n&&null!==n&&a.rttInfo.streams[c].outbound[o].rttArray.push(parseInt(n,10)),void 0!==P&&null!==P&&a.fractionalLossInfo.streams[c].outbound[o].fractionalLossArray.push(P),Q=E(95,a.rttInfo.streams[c].outbound[o].rttArray),T=E(95,a.fractionalLossInfo.streams[c].outbound[o].fractionalLossArray),null!==l&&null!==j&&l>j&&(a.timeElapse.streams[c].outbound[o].totalTimeMs=a.timeElapse.streams[c].outbound[o].totalTimeMs+u),a.timeElapse.streams[c].outbound[o].totalTimeMs>0&&null!==l&&(X=8*l/a.timeElapse.streams[c].outbound[o].totalTimeMs),d.streams[c].outbound[o]={intMs:u,Timestamp:Z.Timestamp,intFL:P,intPR:Y,intBRKbps:N,cumLoss:I,cumSent:B,rtt:n,mediaType:p,sig2Latency:Q,avgBRKbps:X,timeElapseMs:a.timeElapse.streams[c].outbound[o].totalTimeMs,currentDelayMs:v,frameRate:r,res:q,percentileFl:T},p===Jb.audio){var $=Q+40;R=F($,p,Hb),S=G(N,p,Db),s=H(R,S),d.streams[c].outbound[o].mark=s,d.streams[c].outbound[o].eM=$,d.streams[c].outbound[o].ail=Z.audioInputLevel?L(parseInt(Z.audioInputLevel,10)):void 0}else p===Jb.video&&(t=parseInt(a.rttInfo.streams[c].outbound[o].frameRate,10),U=G(t/r,p,Eb),V=F(n,p,Fb),W=G(N,p,Db),s=H(U,V,W),a.rttInfo.streams[c].outbound[o].frameRate=r,d.streams[c].outbound[o].mark=s,d.streams[c].outbound[o].nacks=Z.googNacksReceived?L(parseInt(Z.googNacksReceived,10)):void 0,d.streams[c].outbound[o].firs=Z.googFirsReceived?L(parseInt(Z.googFirsReceived,10)):void 0,d.streams[c].outbound[o].plis=Z.googPlisReceived?L(parseInt(Z.googPlisReceived,10)):void 0)}}function O(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t,u,v,w,B,I,J,N,O,P,Q,R,S=null,T=null,U=null,V=null,W=null,X=null,Y=null,Z=null,$=null,_=null,aa=null;for(q in b.streams[c].inbound)if(b.streams[c].inbound.hasOwnProperty(q)){var ba=b.streams[c].inbound[q].data;if(void 0!==e.streams[c]&&void 0!==e.streams[c].inbound&&void 0!==e.streams[c].inbound[q]?(j=K(parseInt(e.streams[c].inbound[q].data.bytesReceived,10)),n=K(parseInt(e.streams[c].inbound[q].data.packetsLost,10)),Q=K(parseInt(e.streams[c].inbound[q].data.packetsReceived,10)),k=a.lastStatsSent.apiTS):(j=0,k=g,n=0,Q=0),r=x(b.streams[c].inbound[q],f),s=A(b.streams[c].inbound[q],f),u=z(b.streams[c].inbound[q],f),t=D(b.streams[c].inbound[q],f),R=y(b.streams[c].inbound[q],f),p=C(b.streams[c].inbound[q],f),l=K(parseInt(ba.bytesReceived,10)),null!==l&&null!==j&&j>l&&(j=0,n=0,Q=0,pc(Da,Ea,"log",{msg:"getstats: curBytesReceived < prevBytesReceived counter reset",conferenceID:h,ucID:i})),o=L(parseInt(ba.packetsLost,10)),m=g,void 0===d.streams[c]&&(d.streams[c]={}),void 0===d.streams[c].inbound&&(d.streams[c].inbound={}),d.streams[c].inbound[q]={},null!==o&&null!==n&&(T=o-n),P=L(parseInt(ba.packetsReceived,10)),v=P-Q,void 0!==T&&null!==v&&v+T>0&&(V=T/(v+T)),O=m-k,O>0&&(null!==l&&null!==j&&(S=8*(l-j)/O),null!==v&&(U=v/(O/1e3))),a=M(a,c,"rttInfo",q,"inbound","rttArray",!0),a=M(a,c,"timeElapse",q,"inbound","totalTimeMs",!1),a=M(a,c,"jitterInfo",q,"inbound","jitterArray",!0),a=M(a,c,"fractionalLossInfo",q,"inbound","fractionalLossArray",!0),void 0!==p&&null!==p&&a.rttInfo.streams[c].inbound[q].rttArray.push(parseInt(p,10)),void 0!==t&&null!==t&&a.jitterInfo.streams[c].inbound[q].jitterArray.push(parseInt(t,10)),void 0!==V&&null!==V&&a.fractionalLossInfo.streams[c].inbound[q].fractionalLossArray.push(V),W=E(95,a.rttInfo.streams[c].inbound[q].rttArray),X=E(95,a.jitterInfo.streams[c].inbound[q].jitterArray),Y=E(95,a.fractionalLossInfo.streams[c].inbound[q].fractionalLossArray),null!==l&&null!==j&&l>j&&(a.timeElapse.streams[c].inbound[q].totalTimeMs=a.timeElapse.streams[c].inbound[q].totalTimeMs+O),null!==l&&a.timeElapse.streams[c].inbound[q].totalTimeMs>0&&(aa=8*l/a.timeElapse.streams[c].inbound[q].totalTimeMs),d.streams[c].inbound[q]={intMs:O,Timestamp:ba.Timestamp,intFL:V,intPR:U,intBRKbps:S,cumLoss:o,cumRecv:P,rtt:p,mediaType:r,sig2latency:W,avgBRKbps:aa,timeElapseMs:a.timeElapse.streams[c].inbound[q].totalTimeMs,intPktRcv:v,intPktLoss:T,percentileJitter:X,currentDelayMs:R,frameRate:u,res:s,jitter:t,percentileFl:Y},r===Jb.audio){var ca=W+40;Z=F(ca,r,Hb),$=F(V,r,Gb),_=G(S,r,Db),w=H(Z,$,_),d.streams[c].inbound[q].mark=w,d.streams[c].inbound[q].eM=ca,d.streams[c].inbound[q].aol=ba.audioOutputLevel?L(parseInt(ba.audioOutputLevel,10)):void 0}else r===Jb.video&&(B=a.rttInfo.streams[c].inbound[q].frameRate,I=G(B/u,r,Eb),J=F(p,r,Fb),N=G(S,r,Db),w=H(I,J,N),a.rttInfo.streams[c].inbound[q].frameRate=u,d.streams[c].inbound[q].mark=w,d.streams[c].inbound[q].nacks=ba.googNacksSent?L(parseInt(ba.googNacksSent,10)):void 0,d.streams[c].inbound[q].firs=ba.googFirsSent?L(parseInt(ba.googFirsSent,10)):void 0,d.streams[c].inbound[q].plis=ba.googPlisSent?L(parseInt(ba.googPlisSent,10)):void 0)}}function P(a,b,c,d,e,f){var g={streams:{}};g.fabricState=a.pcState,g.connectionState=w();var h=null;h=a.lastStatsSent?a.lastStatsSent.statistics:{streams:{}};var i;for(i in b.streams)b.streams.hasOwnProperty(i)&&(void 0!==b.streams[i].inbound&&O(a,b,i,g,h,c,d,e,f),void 0!==b.streams[i].outbound&&N(a,b,i,g,h,c,d,e,f),void 0===g.streams[i]&&(g.streams[i]={}),b.streams[i].cname&&(g.streams[i].cname=b.streams[i].cname),b.streams[i].usage&&(g.streams[i].usage=b.streams[i].usage),b.streams[i].msid&&(g.streams[i].msid=b.streams[i].msid),b.streams[i].userID&&(g.streams[i].userID=b.streams[i].userID),b.streams[i].associatedVideoTag&&(g.streams[i].associatedVideoTag=b.streams[i].associatedVideoTag));if(c===Ib.firefox)for(i in g.streams)void 0!==g.streams[i].inbound&&void 0!==g.streams[i].inbound[xb.remote]&&(void 0===g.streams[i].outbound&&(g.streams[i].outbound={}),void 0===g.streams[i].outbound[xb.local]&&(g.streams[i].outbound[xb.local]={}),g.streams[i].outbound[xb.local].rtt=g.streams[i].inbound[xb.remote].rtt);return g}function Q(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===zb.bad?a.streams[b].inbound[d].mark=2:c===zb.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===zb.bad?a.streams[b].outbound[d].mark=2:c===zb.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function R(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function S(a){var b={};a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),Ja&&(b.conferenceURL=Ja);var c,d,e,f;b.streams={};for(c in a.streams)if(a.streams.hasOwnProperty(c)){if(void 0===b.streams[c]&&(b.streams[c]={}),a.streams[c].cname&&(b.streams[c].cname=a.streams[c].cname),a.streams[c].msid&&(b.streams[c].msid=a.streams[c].msid),a.streams[c].userID&&(b.streams[c].remoteUserID=a.streams[c].userID),a.streams[c].usage&&(b.streams[c].usageLabel=a.streams[c].usage),a.streams[c].associatedVideoTag&&(b.streams[c].associatedVideoTag=a.streams[c].associatedVideoTag),void 0!==a.streams[c].inbound)for(d in a.streams[c].inbound)a.streams[c].inbound.hasOwnProperty(d)&&(e=a.streams[c].inbound[d],d===xb.local&&(b.streams[c].reportType=xb.inbound,e.hasOwnProperty("intFL")&&(b.streams[c].fractionLoss=e.intFL),e.hasOwnProperty("intBRKbps")&&(b.streams[c].bitrate=e.intBRKbps),e.hasOwnProperty("mark")&&(b.streams[c].quality=e.mark),e.hasOwnProperty("mediaType")&&(b.streams[c].mediaType=e.mediaType),e.hasOwnProperty("rtt")&&(b.streams[c].rtt=e.rtt),e.hasOwnProperty("jitter")&&(b.streams[c].jitter=e.jitter),e.hasOwnProperty("aol")&&(b.streams[c].audioOutputLevel=e.aol),e.hasOwnProperty("ail")&&(b.streams[c].audioInputLevel=e.ail)));if(void 0!==a.streams[c].outbound)for(d in a.streams[c].outbound)a.streams[c].outbound.hasOwnProperty(d)&&d===xb.local&&(f=a.streams[c].outbound[d],b.streams[c].reportType=xb.outbound,f.hasOwnProperty("intFL")&&(b.streams[c].fractionLoss=f.intFL),f.hasOwnProperty("intBRKbps")&&(b.streams[c].bitrate=f.intBRKbps),f.hasOwnProperty("mark")&&(b.streams[c].quality=f.mark),f.hasOwnProperty("mediaType")&&(b.streams[c].mediaType=f.mediaType),f.hasOwnProperty("rtt")&&(b.streams[c].rtt=f.rtt),f.hasOwnProperty("jitter")&&(b.streams[c].jitter=f.jitter),f.hasOwnProperty("ail")&&(b.streams[c].audioInputLevel=f.ail),f.hasOwnProperty("aol")&&(b.streams[c].audioOutputLevel=f.aol))}return b}function T(a,b,c,e,g,h){var i=f();d("Pushing to the cloud ",a),oa(qb.rtpStats,ob.fabricStats,a,h),b.latestEventSent=i,b.lastFabricState=b.pcState}function U(a,b,c,e,g,h){var i=f();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&na()&&!eb?(d("Pushing to the cloud ",a),oa(qb.processedStats,ob.fabricStats,a,h),b.latestEventSent=i,b.lastFabricState=b.pcState):(a.clockUnsynced=eb,Qb({type:qb.processedStats,action:ob.fabricStats,data:a}),a.hasOwnProperty("token")||rc(Da,Ga,g))}function V(a,b,c,d,e,h,k){function l(l){var m=f(),n=g();void 0===e.lastRawStatsSentInterval||null===e.lastRawStatsSentInterval?e.lastRawStatsSentInterval=n-e.statsPollingStart:e.lastRawStatsSentInterval=n-e.rawstatsTS+e.lastRawStatsSentInterval,void 0===e.lastProcessedStatsSentInterval||null===e.lastProcessedStatsSentInterval?e.lastProcessedStatsSentInterval=n-e.statsPollingStart:e.lastProcessedStatsSentInterval=n-e.rawstatsTS+e.lastProcessedStatsSentInterval,e.rawstatsTS=n;var o={},p=$a.codebase;o.version=Ba,o.appID=Da,o.conferenceID=encodeURIComponent(c),o.apiTS=m,o.timeShift=0,o.fabricState=e.pcState,o.pcID=e.pcHash,void 0!==d&&(o.ucID=d),Ha?o.token=Ha.challenge.token:rc(Da,Ga,a),o.localID=encodeURIComponent(a),o.remoteID=encodeURIComponent(b),o.deviceID=Ia;var q,r,s,t,u,w,x,y={streams:{}},z=null,A=!1,B=!1,C={},D={};if(p===Ib.firefox&&"Safari"!==$a.name)z=[],l.forEach(function(a){z.push(a)});else if(p===Ib.chrome&&"Safari"!==$a.name)z=l.result();else{z=[];for(q in l)z.push(l[q])}for(q=0;q<z.length;++q)if(r=$(z[q]),s=X(JSON.parse(r),p),!_(s))if(s.hasOwnProperty("Transport"))t="Transport",y.hasOwnProperty(t)||(y[t]=[]),p!==Ib.firefox?(parseInt(s[t].bytesReceived,10)>0||parseInt(s[t].bytesSent,10)>0)&&(y[t].push(s[t]),"true"===s[t].googActiveConnection&&(o.activeConnectionIndex=y[t].length)):(y[t].push(s[t]),"true"===s[t].selected&&(o.activeConnectionIndex=y[t].length));else if(s.hasOwnProperty("localCandidate"))C[s.localCandidate.id]=s.localCandidate;else if(s.hasOwnProperty("remoteCandidate"))D[s.remoteCandidate.id]=s.remoteCandidate;else if(s.hasOwnProperty("bwe"))y.bwe=s.bwe;else{if(w=Sb(s.ssrc),void 0===w||!w.localStartTime){var E=Ub(b,c,d,e,h,null);E&&(B=!0),w=Sb(s.ssrc)}w&&(u=w.remoteUserID),void 0===u&&(u=b),void 0===y.streams[s.ssrc]&&(y.streams[s.ssrc]={userID:u},void 0!==w&&(y.streams[s.ssrc].cname=w.cname,y.streams[s.ssrc].msid=w.msid)),s.inbound?(void 0===y.streams[s.ssrc].inbound&&(y.streams[s.ssrc].inbound={}),x=y.streams[s.ssrc].inbound,x[s.reportType]={data:s.data},w&&(y.streams[s.ssrc].usage=w.usage,y.streams[s.ssrc].associatedVideoTag=w.associatedVideoTag)):(void 0===y.streams[s.ssrc].outbound&&(y.streams[s.ssrc].outbound={}),y.streams[s.ssrc].outbound[s.reportType]={data:s.data})}p===Ib.firefox&&(y.Transport=R(y.Transport,C,D));var F;if(y.Transport)for(F=0;F<y.Transport.length;F++)y.Transport[F].hash=v(y.Transport[F],p);o.statistics=y,y.Transport&&(A=Z(y.Transport,e)),A&&_b(h,pb.updatedConfiguration,c),e.pcState===Ab.disrupted&&ca(o);var G=P(e,y,p,m,c,d);if(y.Transport&&(G.Transport=J(e,y.Transport,p,m)),y.bwe&&(G.bwe=y.bwe),void 0===e.processedStatsTupleArray&&(e.processedStatsTupleArray=[]),ya){var H=S(G);ya(H)}G.apiTS=m,G.batteryStatus={},G.batteryStatus.batteryLevel=i(),G.batteryStatus.isBatteryCharging=j(),G=Q(G),e.processedStatsTupleArray.push(G),o.processedStatistics=e.processedStatsTupleArray,e.lastStatsSent=o;var I=sa(o),K=sa(o);delete I.processedStatistics,delete K.statistics,B&&Vb(pb.ssrcMap,b,c,d,Tb(),e.pcHash),(e.lastProcessedStatsSentInterval>=Pa||e.initialPhaseOver)&&(e.processedStatsTupleArray=[],U(K,e,c,b,a,k),e.lastProcessedStatsSentInterval=0),e.lastRawStatsSentInterval>=Oa&&(T(I,e,c,b,a,k),e.lastRawStatsSentInterval=0)}return l}function W(a){var b;return Bb.hasOwnProperty(a)?a===Bb.createOffer||a===Bb.createAnswer||a===Bb.setRemoteDescription?b=Cb.negotiationFailure:a===Bb.setLocalDescription?b=Cb.sdpError:a===Bb.addIceCandidate?b=Cb.sdpError:a===Bb.getUserMedia?b=Cb.mediaConfigError:a===Bb.iceConnectionFailure?b=Cb.iceFailure:a===Bb.signalingError?b=Cb.signalingError:a===Bb.applicationError&&(b=Cb.applicationError):b=Kb.invalidWebRTCFunctionName,b}function X(a,b){var c={};return b===Ib.firefox?"inboundrtp"===a.type||"outboundrtp"===a.type?(c.ssrc=a.ssrc,c.inbound="inboundrtp"===a.type,c.data=a,c.mediaType=a.mediaType,c.reportType="true"===a.isRemote?"remote":"local"):"candidatepair"===a.type&&a.selected?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a):b===Ib.chrome?"ssrc"===a.type?(c.reportType="local",a.bytesSent?c.inbound=!1:c.inbound=!0,c.ssrc=a.ssrc,c.data=a):"googCandidatePair"===a.type?c.Transport=a:"VideoBwe"===a.type&&(c.bwe=a):b===Ib.edge&&("inbound-rtp"===a.type||"outbound-rtp"===a.type?(c.ssrc=a.ssrc,c.inbound="inbound-rtp"===a.type,c.data=a,c.reportType="local"):"transport"===a.type&&(c.Transport=a)),c}function Y(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function Z(a,b){var c,d,e,f,g,h,i,j,k=!1,l="None",m=!1;for(i=0;i<a.length;i++)if(j=a[i],navigator.mozGetUserMedia&&"candidatepair"===j.type&&"true"===j.selected?(m=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType):"googCandidatePair"===j.type&&"true"===j.googActiveConnection&&(m=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType),m){h=0===c.indexOf("["),b.iceCandidates.some(function(a){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c?(b>=0&&2>=b&&(l=Y(b)),!0):!1});break}var n=b.transportData;return void 0!==n&&n.localAddr===c&&n.remoteAddr===d&&n.localAddrType===e&&n.remoteAddrType===f&&n.transportType===g||(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:l},k=!0),k}function $(a){var b="";b+='{"Timestamp":"',b+=a.timestamp instanceof Date?a.timestamp.getTime().toString():a.timestamp,b+='",',a.type&&(b+='"type" : "'+a.type+'",');var c=0;if(a.names){var d=a.names();for(c=0;c<d.length;++c)b+='"',b+=d[c],b+='" : "',b+=a.stat(d[c]),b+='"',c+1!==d.length&&(b+=",")}else{var e=Object.keys(a).length;c=0;var f;for(f in a)a.hasOwnProperty(f)&&(c++,"timestamp"!==f&&(b+='"',b+=f,b+='" : "',b+=a[f],b+='"',e>c&&(b+=",")))}return b+="}"}function _(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;for(var b in a)if(a.hasOwnProperty(b))return!1;return!0}function aa(a){return{magicKey:a,statsSubmissionInterval:Ua,endpoint:ab,localDisplayUserID:Fa,connectedDevices:wa}}function ba(a,b,c){var d=bb[a];void 0===d&&(bb[a]={},bb[a].participants={},c&&(bb[a].userJoinedSent=!0),b&&(bb[a].refreshPresence=b))}function ca(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function da(a){return clearInterval(a),null}function ea(){var a;for(a in bb)bb.hasOwnProperty(a)&&(bb[a].refreshPresence=da(bb[a].refreshPresence),delete bb[a].refreshPresence);ua()}function fa(){var a;for(a in bb)bb.hasOwnProperty(a)&&(Xb(a),bb[a].refreshPresence=setInterval(function(){Xb(a)},Wa));va()}function ga(a){var b,c=bb[a],d=!1;if(void 0!==c)if(Object.keys(c.participants).length>0)d=!0;else for(b=0;b<gb.length;b++)if(gb[b].confID===a){d=!0;break}return d}function ha(a,b,c){var d,e=bb[a];if(void 0===e)d=new Hashtable({hashCode:l,equals:n}),d.put(c.pc,c),bb[a].participants[b]=d;else{var f=e.participants[b];if(void 0===f)d=new Hashtable({hashCode:l,equals:n}),d.put(c.pc,c),e.participants[b]=d;else{if(f.containsKey(c.pc))return;f.put(c.pc,c)}}}function ia(a,b){var c=!1;if(!bb[a])return{conferenceFinished:c,ucID:null};var d=bb[a].ucID;return 0===bb[a].participants[b].size()&&delete bb[a].participants[b],0===Object.keys(bb[a].participants).length&&(da(bb[a].refreshPresence),ua(),delete bb[a],c=!0),{conferenceFinished:c,ucID:d}}function ja(a,b){Vb(pb.userLeft,null,a,b,null,null,null),ib=da(ib),ua(),hb=Nb,Nb=null}function ka(a,b,c){var d=!1;if(null!==a&&void 0===a.challenge)return d;if(null!==a&&a.challenge.appID===b&&a.challenge.userID===encodeURIComponent(c)){var e=null;if(navigator.mozGetUserMedia){var g=a.challenge.expires.split(" ").join("T");e=Date.parse(g)}else e=new Date(a.challenge.expires);var h=new Date(f());e>h&&(d=!0)}return d}function la(a,b){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c)),Ja[a]=Ka+encodeURIComponent(a)+"&ucid="+b}function ma(a){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));return b[a]?b[a].ucID:null}function na(){return Ra}function oa(a,b,c,d){a===qb.clockSync?na()?(db.syncStartTime=g(),c.syncStartTime=db.syncStartTime,c.offsetResultsLength=db.offsetResults.length,Qa.emit(a,JSON.stringify(c)),d&&b!==ob.fabricStats&&d(rb.success,b+" sent to the backend.")):setTimeout(function(){sc()},100):ka(Ha,Da,Ea)?eb&&c.action!==pb.userJoined&&c.action!==pb.refreshPresence&&c.action!==pb.fabricSetupFailed||!na()?(c.clockUnsynced=eb,Qb({type:b,action:a,data:c,callback:d})):(Qa.emit(a,JSON.stringify(c)),d&&b!==ob.fabricStats&&d(rb.success,b+" sent to the backend.")):rc(Da,Ga,Ea,function(e,f){e!==rb.success?(e===tb.authOngoing&&(c.clockUnsynced=eb,Qb({type:b,action:a,data:c,callback:d})),d&&e!==tb.authOngoing&&d(e,f)):e===rb.success&&"SDK authentication successful."===f&&(eb&&b!==pb.userJoined&&c.action!==pb.refreshPresence&&c.action!==pb.fabricSetupFailed||!na()?(c.clockUnsynced=eb,Qb({type:b,action:a,data:c,callback:d})):(c.token=Ha.challenge.token,Qa.emit(a,JSON.stringify(c)),d&&b!==ob.fabricStats&&d(rb.success,b+" sent to the backend.")))})}function pa(a,b,d,e,f){var g=new c(b,"TEXT"),h=g.getHMAC(a,"TEXT","SHA-1","B64"),i={};i.version=Ba,i.challenge={},i.challenge.response=h,i.challenge.original=b,i.appID=d,i.userID=encodeURIComponent(e),i.authType=Ca;var j=za+"o/challenge";qc(j,JSON.stringify(i),function(c){var g;if(200===c.status)g=JSON.parse(c.response),void 0!==g.challenge.status&&g.challenge.status!==rb.ok?g.challenge.reason===sb.csProtoError?(Ya=!1,qa(f)):g.challenge.reason===sb.csNoAuthState&&(Za||(Za=setTimeout(function(){rc(Da,Ga,Ea,f)},Xa))):(g.appID=d,window.localStorage.setItem("auth_data",JSON.stringify(g)),Da=d,Ga=a,Ea=e,Ha=g,Ya=!1,Ua=parseInt(g.challenge.submissionInterval,10),Va=g.challenge.collectSDP,f&&f(rb.success,"SDK authentication successful."),na()?(Pb(),f&&f(rb.success,"WebSocket establishment successful.")):uc(za+Ta,function(a,b){void 0!==f&&f(a,b)}));else if(200!==c.status&&(502!==c.status&&0!==c.status||setTimeout(function(){pa(a,b,d,e,f)},Xa),f)){var h;400===c.status?(h=c.responseText,f(rb.authError,h)):502===c.status||0===c.status?(h="HTTP "+c.status+", "+c.statusText+". Server temporarily unavailable. Retrying in "+Xa+"ms",f(rb.appConnectivityError,h)):(h="HTTP "+c.status+", "+c.statusText+". "+c.responseText,f(rb.httpError,h))}})}function qa(a){return a?void a(rb.csProtoError,"Fatal authentication error. Invalid auth protocol message."):void console.error("Fatal authentication error. Invalid auth protocol message.")}function ra(a){a&&a(tb.authOngoing,null)}function sa(a){if(null===a||"object"!=typeof a)return a;var b=new a.constructor;for(var c in a)b[c]=sa(a[c]);return b}function ta(){var a={};Object.keys(bb).forEach(function(b){var c=bb[b];if(!c)return!0;var d={ucID:c.ucID,userJoinedSent:c.userJoinedSent},e={};c.participants&&Object.keys(c.participants).forEach(function(a){for(var b=c.participants[a].values(),d=[],f=0;f<b.length;f++){var g=b[f];d.push({pcID:g.pcHash,pcState:g.pcState,iceConnectionState:g.iceConnectionState,iceGatheringState:g.iceGatheringState,iceCandidatesNumber:g.iceCandidates.length})}e[a]=d}),d.participants=e,a[b]=d});var b={authStatus:!!Ha,clockSync:!eb,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:Ba};pc(Da,Ea,"stateMachine",b)}function ua(){jb||(jb=setInterval(function(){ta()},kb))}function va(){da(jb),jb=null}var wa,xa,ya,za="https://collector.callstats.io:443/",Aa="443",Ba="3.11.9",Ca="BasicAuth",Da=-1,Ea="",Fa=null,Ga=null,Ha=null,Ia=null,Ja={},Ka="https://dashboard.callstats.io/search?confid=",La=!1,Ma=!1,Na=3e4,Oa=6e4,Pa=1e4,Qa=null,Ra=!1,Sa=!1,Ta="collectCallStats",Ua=15e3,Va=!1,Wa=1e4,Xa=5e3,Ya=!1,Za=null,$a=detectBrowserInfo(),_a=measureAppLoadingPerformance($a),ab={type:"browser",name:$a.name,ver:$a.ver,os:$a.os},bb={},cb={statsSubmissionIntervalInMS:[1e3,2e3,5e3,1e4],statsSubmissionPhaseDurationInMS:[1e4,3e4,8e4,18e4],currentActivePhaseIndex:0},db={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},eb=!0,fb={},gb=[],hb=null,ib=null,jb=null,kb=2e4,lb=[],mb=100,nb=null;"Firefox"===$a.name?nb=mozRTCPeerConnection:"Chrome"===$a.name||"Opera"===$a.name?nb=webkitRTCPeerConnection:"Safari"===$a.name?d("Browser type Safari"):"Edge"===$a.name&&(nb=window.RTCPeerConnection);var ob={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},pb={fabricDisrupted:"fabricDisrupted",autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",updatedConfiguration:"updatedConfiguration",refreshPresence:"refreshPresence",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent"},qb={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},rb={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",ok:"OK"},sb={csProtoError:"Protocol fields cannot be empty.",csNoAuthState:"Authentication state unavailable in server."},tb={authOngoing:"authOngoing"},ub={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},vb={local:"local",remote:"remote"},wb={excellent:5,good:4,fair:3,poor:2,bad:1},xb={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},yb={excellent:3,fair:2,bad:1},zb={excellent:"excellent",fair:"fair",bad:"bad"},Ab={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted"},Bb={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError"
},Cb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError"},Db={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},Eb={video:{gThreshold:.8,rThreshold:.3}},Fb={video:{gThreshold:400,rThreshold:1e3}},Gb={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},Hb={audio:{gThreshold:240,rThreshold:400}},Ib={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},Jb={unknown:"unknown",audio:"audio",video:"video"},Kb={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Lb="fabricSetupFailed error reported by the developer",Mb="Connectivity Failure",Nb=e(),Ob=function(a,b){if(!Ha)return void rc(Da,Ga,Ea);if(!eb){var c,d,e,g=f(),h=[],i=Math.max(Ua/lb.length,mb);for(c=0;c<lb.length;c++)if(d=lb[c],d.data.action!==pb.userJoined){if(d.data.token=Ha.challenge.token,(a&&d.data.apiTS>=g-b||!d.data.ucID)&&(e=decodeURIComponent(d.data.conferenceID),d.data.ucID=bb[e].ucID),d.data.clockUnsynced&&(d.data.apiTS+=db.currentOffset),d.action===ob.fabricStats&&d.data.clockUnsynced&&d.data.processedStatistics&&d.data.processedStatistics.length>0)for(var j=0;j<d.data.processedStatistics.length;j++)d.data.processedStatistics[j].apiTS+=db.currentOffset;delete d.data.clockUnsynced,q(d,i*(c+1))}else h.push(lb[c]);lb=h}},Pb=function(){if(!Ha)return void rc(Da,Ga,Ea);var a,b,c=[],d=Math.max(Ua/lb.length,mb);for(a=0;a<lb.length;a++)b=lb[a],b.type!==qb.callStatsEvent||b.data.action!==pb.userJoined&&b.data.action!==ob.fabricSetupFailed?c.push(lb[a]):(b.data.token=Ha.challenge.token,b.data.clockUnsynced&&(b.data.apiTS=b.data.apiTS+db.currentOffset),b.data.value&&(b.data.value.statsSubmissionInterval=Ua),q(b,d*(a+1)));lb=c},Qb=function(a){lb.push(a)},Rb=function(a,b){var c=RegExp.prototype.test.bind(/^([a-z])=(.*)/),d=/^ssrc:(\d*) ([\w_]*):(.*)/;a.split(/(\r\n|\r|\n)/).filter(c).forEach(function(a){var c=a[0],e=a.slice(2);if("a"===c&&d.test(e)){var h=e.match(d),i=h[1];void 0===fb[i]&&(fb[i]={}),fb[i][h[2]]=h[3],fb[i].localStartTime=g(),fb[i].syncedStartTime=f(),fb[i].streamType=b}})},Sb=function(a){return fb[a]},Tb=function(){return fb},Ub=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(Rb(g,xb.outbound),Rb(h,xb.inbound),Va){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Wb(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Vb=function(a,b,c,d,e,g,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=f(),j={version:Ba,apiTS:i,action:a,localID:encodeURIComponent(Ea),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(c),timeShift:0,appID:Da,ucID:d,pcID:g,deviceID:Ia,value:e};return null===b&&(j.remoteID=null),null===c?void pc(Da,Ea,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(Ha&&na()&&(d&&!eb||a===pb.userJoined||a===ob.fabricSetupFailed||a===pb.refreshPresence)?(j.token=Ha.challenge.token,oa(qb.callStatsEvent,a,j,h)):(j.clockUnsynced=eb,Ha||rc(Da,Ga,Ea),a!==pb.fabricStatsCaching&&a!==pb.refreshPresence&&Qb({type:qb.callStatsEvent,action:qb.callStatsEvent,data:j,callback:h})))},Wb=function(a,b,c,d,e,g){var h=f(),i={version:Ba,appID:Da,conferenceID:encodeURIComponent(b),ucID:c,apiTS:h,localID:encodeURIComponent(Ea),remoteID:encodeURIComponent(a),pcID:e,deviceID:Ia,sdpPayload:d};Ha&&na()&&c&&!eb?(i.token=Ha.challenge.token,oa(qb.sdpSubmission,qb.sdpSubmission,i,g)):(i.clockUnsynced=eb,Qb({type:qb.sdpSubmission,action:qb.sdpSubmission,data:i,callback:g}),Ha||rc(Da,Ga,Ea))},Xb=function(a){var b={ucID:bb[a].ucID,magicKey:Nb,endpoint:ab,fabricState:{}},c=bb[a];if(c){var d,e,f=c.participants,g=0;for(d in f){e=f[d];for(var h=e.keys(),i=0;i<h.length;i++){var j=e.get(h[i]),k=j.pcHash;b.fabricState[g]={},b.fabricState[g].pc=k,b.fabricState[g].userId=d,b.fabricState[g].pcState=j.pcState,b.fabricState[g].iceConnectionState=j.pc.iceConnectionState,b.fabricState[g].iceGatheringState=j.pc.iceGatheringState,b.fabricState[g].iceCandidatesNumber=j.iceCandidates.length,b.fabricState[g].numNegotiationNeededCalls=j.numNegotiationNeededCalls,g++}}}eb||(b.clockSyncOffset=db.currentOffset),Vb(pb.refreshPresence,null,a,bb[a].ucID,b,null)},Yb=function(a){var b={appID:Da,userID:encodeURIComponent(Ea),version:Ba,endpoint:ab,pagePerf:_a,endpointID:Ia,wsID:a.io.engine.id};-1!==Da&&Ha&&(b.token=Ha.challenge.token,a.emit(qb.registerPresence,JSON.stringify(b)))},Zb=function(){var a=window.localStorage.getItem("feedback"),b=JSON.parse(window.localStorage.getItem("auth_data"));if(null!==a){var c=JSON.parse(a),d=b.challenge.token===c.token;d||Ea!==c.userID||(c.token=b.challenge.token,d=!0),d?oa(qb.userFeedback,qb.userFeedback,c):window.localStorage.removeItem("feedback")}},$b=function(a,b,d,e,f,h){if(!a||!b||null===d||void 0===d||0>=a)return void console.error("initialize: Argument missing/invalid");if("string"==typeof a&&(a=parseInt(a,10)),Da=a,Ga=b,"object"==typeof d?(Ea=d.actualID,Fa=d.displayID):Ea=d,h&&(h.disableBeforeUnloadHandler===!0&&(La=!0),null===h.applicationVersion&&void 0===h.applicationVersion||(ab.appVer=h.applicationVersion)),p(),Ia=window.localStorage.getItem("endpointID"),null===Ia){var i=g(),j=Math.random()*i,l=new c(j.toString(),"TEXT");Ia=l.getHash("SHA-1","B64"),window.localStorage.setItem("endpointID",Ia)}k(),ya=f;var m=JSON.parse(window.localStorage.getItem("auth_data"));ka(m,a,d)?(e&&e(rb.success,"SDK already authenticated."),Ua=parseInt(m.challenge.submissionInterval,10),Va=m.challenge.collectSDP,Ha=m,na()||uc(za+Ta,e)):rc(a,b,d,e)},_b=function(a,b,c,d){if(!a||!b||!c)return void console.error("sendFabricEvent: Arguments missing/Invalid");if((!Da||0>Da||!Ga||""===Ea||!bb[c]||0===Object.keys(bb[c].participants).length)&&b!==ob.fabricSetupFailed)return void console.error("sendFabricEvent: SDK is not initialized or no Fabrics added.");if(!u(a))return void console.error("sendFabricEvent: Invalid PeerConnection object passed");if(!ob.hasOwnProperty(b)&&!pb.hasOwnProperty(b))return void console.error("sendFabricEvent: Invalid fabricEvents value: ",b);var e=null,f=null,h=g(),i=bb[c],j=null;if(void 0===i)return void console.error("sendFabricEvent: Conference ID not found!");if(Object.keys(bb[c].participants).length>0&&(f=gc(i,a),null!==f&&(j=bb[c].participants[f].get(a))),null===j){var k=l(a),m=ic(k);if(null===m)return void console.error("sendFabricEvent: pcObject is null");f=m.remoteID,j=m.fabricData}var n=j.startTime;if(!(b===ob.fabricSetup||b===pb.autoFabricSetup&&j.fabricSetupSent)){if(b===pb.autoFabricSetup){var o=h-j.startTime;e={setupDelay:o,iceCandidates:j.iceCandidates,iceGatheringDelay:j.gatheringIceCandidatesDelay,iceConnectivityDelay:j.connectivityIceStatusDelay},j.pcState=Ab.established,j.fabricSetupSent=!0}else if(b===pb.autoFabricSetupFailed)e={failureDelay:j.setupFailureTime,reason:Cb.iceFailure,domError:Mb};else if(b===pb.fabricDisrupted)e={disruptionDelay:j.connectivityIceStatusDelay};else if(b===pb.updatedConfiguration)e=j.transportData;else if(b===ob.fabricSetupFailed){var p=h-n;e={failureDelay:p,reason:Cb.iceFailure,domError:Lb,fabricState:j.pcState,iceConnectionState:j.pc.iceConnectionState,"function":Bb.iceConnectionFailure,magicKey:Nb,endpoint:ab}}else if(b===ob.activeDeviceList){if(!d||!d.deviceList)return void console.error("sendFabricEvent: Arguments missing/Invalid");e={magicKey:Nb,endpoint:ab,activeDevicelist:d.deviceList}}if(Vb(b,f,c,i.ucID,e,j.pcHash,j.pcCallback),(b===ob.fabricTerminated||b===pb.autoFabricSetupFailed||b===ob.fabricSetupFailed)&&bb[c].participants[f]){j&&(j.statsInterval=da(j.statsInterval)),bb[c].participants[f].remove(a);var q=ia(c,f);q.conferenceFinished&&ja(c,q.ucID)}if((b===ob.fabricSetup||b===ob.fabricUsageEvent)&&!j.fabricUsageSent){var r=j.fabricUsage;j.fabricUsageSent=!0,Vb(ob.fabricUsageEvent,f,c,i.ucID,r,j.pcHash,null)}}},ac=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},bc=function(a,b,c,d,f,h){if(void 0===a||!c||!b)return void console.error("reportError: Arguments missing/invalid");if(0>Da||!Da||!Ga||""===Ea)return void console.error("reportError: SDK is not initialized");if(!Bb.hasOwnProperty(c))return void console.error("reportError: Invalid webRTC functionName value: %o",c);void 0===d&&console.warn("reportError: Missing dom error parameter");var i,j=null,k=null,l=g(),n=bb[b],o=null;if(i=W(c),d&&d instanceof DOMException)d={message:d.message,name:d.name};else if(d&&"object"==typeof d){var p={};"message"in d&&(p.message=d.message),"name"in d&&(p.name=d.name),"constraintName"in d&&(p.constraintName=d.constraintName),"stack"in d&&(p.stack=d.stack),d=p}if(u(a)){if(void 0===n)return void console.error("reportError: Conference ID not found!");if(Object.keys(bb[b].participants).length>0&&(k=gc(n,a),null!==k&&(o=bb[b].participants[k].get(a))),null===o){var q=hc(a);if(null===q)return void console.error("reportError: Invalid pcObject passed as argument");k=q.remoteID,o=q.fabricData,o.pcHash=m(k.concat(":",b))}var r=o.startTime,s=l-r;if(j={failureDelay:s,reason:i,domError:d,fabricState:o.pcState,iceConnectionState:o.pc.iceConnectionState,"function":c,magicKey:Nb,endpoint:ab},c===Bb.applicationError?Vb(ob.applicationErrorLog,k,b,n.ucID,j,o.pcHash,o.pcCallback):Vb(ob.fabricSetupFailed,k,b,n.ucID,j,o.pcHash,o.pcCallback),f||h||a&&a.localDescription||a&&a.remoteDescription){var t={sdp:{}};t.sdp.localSDP=ac(a,f,"localDescription"),t.sdp.remoteSDP=ac(a,h,"remoteDescription"),Wb(k,b,n.ucID,t,o.pcHash)}}else{null===Nb&&(Nb=e());var v=e();j={failureDelay:0,reason:i,domError:d,"function":c,magicKey:Nb,endpoint:ab},c===Bb.applicationError?Vb(ob.applicationErrorLog,k,b,null,j,v,null):Vb(ob.fabricSetupFailed,k,b,null,j,v,null)}},cc=function(a,b,c){if(!b||!a)return void console.error("sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return void console.error("sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return void console.error("sendUserFeedback: Feedback data object must not be empty.");if(!b.hasOwnProperty("overall"))return void console.error("sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys.");var d=bb[a],e=null;void 0!==d&&void 0!==d.ucID&&(e=d.ucID);var f=null;if(f=null===Nb?hb:Nb,null===e&&(e=ma(a)),null===e)return void console.error("sendUserFeedback: ucID unavailable");var g={conferenceID:encodeURIComponent(a),magicKey:f,appID:Da,version:Ba,ucID:e,userID:encodeURIComponent(b.userID),userQoe:{overall:b.overall}};b.hasOwnProperty("video")?g.userQoe.video=b.video:g.userQoe.video=-1,b.hasOwnProperty("audio")?g.userQoe.audio=b.audio:g.userQoe.audio=-1,b.hasOwnProperty("screen")?g.userQoe.screen=b.screen:g.userQoe.screen=-1,b.hasOwnProperty("comment")?g.userQoe.comment=b.comment:g.userQoe.comment=-1,Ha&&!eb?(g.token=Ha.challenge.token,window.localStorage.setItem("feedback",JSON.stringify(g)),oa(qb.userFeedback,qb.userFeedback,g,c)):(g.clockUnsynced=eb,Qb({type:qb.userFeedback,action:qb.userFeedback,data:g,callback:c}),rc(Da,Ga,Ea))},dc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.actualID:b,!(a&&c&&g&&d&&e))return void console.error("associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return void console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!u(a))return void console.error("associateMstWithUserID: Invalid PeerConnection object passed");var h=bb[c];if(void 0===h)return void console.error("associateMstWithUserID: conferenceID doesn't exist");var i,j,k=h.participants,l=null;for(i in k)if(k.hasOwnProperty(i)&&(j=k[i],l=j.get(a)))break;if(null===l){var m=hc(a);if(null===m)return void console.error("associateMstWithUserID: Unknown pcObject passed");l=m.fabricData}var n=Sb(d);void 0===n&&(fb[d]={},n=Sb(d)),n.remoteUserID=g,n.ssrc=d,n.associatedVideoTag=f,n.usageLabel=e,f&&g!==Ea&&t(g,c,f,a,d)},ec=function(a,b,c,d,f){var h=null,i=null,j={authStatus:!!Ha,clockSync:!eb,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:d,version:Ba};if(pc(Da,Ea,"stateMachine",j),"object"==typeof b?(h=b.actualID,i=b.displayID):h=b,!(a&&h&&c&&d))return void console.error("addNewFabric: Arguments missing/Invalid");if(0>Da||!Da||!Ga||""===Ea)return void console.error("addNewFabric: SDK not initialized.");if(""===d||""===h)return void console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!u(a))return void console.error("addNewFabric: Invalid PeerConnection object passed");if(!ub.hasOwnProperty(c)||c instanceof Function)return void console.error("addNewFabric: Invalid fabricUsage value");var k=g();null===Nb&&(Nb=e());var m=null,n=!1;if(!ga(d)){var p=aa(Nb);Vb(pb.userJoined,null,d,null,p,null,null),n=!0,j={authStatus:!!Ha,clockSync:!eb,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:d,version:Ba},pc(Da,Ea,"stateMachine",j)}a.addEventListener("icecandidate",nc,!1),a.addEventListener("iceconnectionstatechange",mc,!1),a.addEventListener("signalingstatechange",jc,!1),a.addEventListener("negotiationneeded",lc,!1);var q=l(a),r={pc:a,fabricUsage:c,magicKey:Nb,startTime:k,pcCallback:f,pcState:Ab.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:a.iceConnectionState,latestEventSent:k,pcHash:q,localSDP:-1,remoteSDP:-1,statsInterval:null,initialPhaseOver:!1,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0};if("function"==typeof a&&(a.callstatsID=e()),"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState||(r.pcState=Ab.established),ba(d,m,n),o(a))ha(d,h,r);else{var s={confID:d,remoteID:h,fabricData:r};a.callstatsID&&(s.callstatsID=a.callstatsID),gb.push(s)}r.pcState===Ab.established&&(_b(a,pb.autoFabricSetup,d),kc(r,a,d,h))},fc=function(a,b,c,d){if(!(a&&c&&d&&b))return void console.error("reportUserIDChange: Arguments missing/Invalid");if(0>Da||!Da||!Ga||""===Ea)return void console.error("reportUserIDChange: SDK not initialized.");if(""===c||""===b)return void console.error("reportUserIDChange: id or  conferenceID MUST not be empty");if(!u(a))return void console.error("reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=bb[b];if(void 0===g)return void console.error("reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),void pc(Da,Ea,"log",{msg:"### reportUserIDChange: addNewFabric was not called"});if(h=g.ucID,Object.keys(bb[b].participants).length>0&&(e=gc(g,a),null!==e&&(f=bb[b].participants[e].get(a))),null===f){var i=hc(a);if(null===i)return void console.error("reportUserIDChange: Invalid pcObject passed as argument");e=i.remoteID,f=i.fabricData}var j={id:c,idType:d};Vb(ob.userIDChangedEvent,e,b,g.ucID,j,null,f.pcCallback)},gc=function(a,b){var c;for(c in a.participants)if(a.participants.hasOwnProperty(c)&&a.participants[c].containsKey(b))return c;return null},hc=function(a){var b;for(b=0;b<gb.length;b++)if(a===gb[b].fabricData.pc||a.callstatsID&&a.callstatsID===gb[b].callstatsID)return gb[b];return null},ic=function(a){var b;for(b=0;b<gb.length;b++)if(gb[b].fabricData.pcHash===a)return gb[b];return null},jc=function(a){if(a){var b,c=$a.codebase;if(c===Ib.firefox)b=a.target;else if(c===Ib.chrome)b=a.srcElement;else{if(c!==Ib.edge)return void console.error("PeerConnection signaling state changed: unsupported code base");b=a.pc}if(void 0!==b){var d=b.signalingState;if("closed"===d){var e,f;for(e in bb)if(bb.hasOwnProperty(e))for(f in bb[e].participants)if(bb[e].participants.hasOwnProperty(f)&&bb[e].participants[f].containsKey(b))return void _b(b,ob.fabricTerminated,e)}else if("have-local-offer"===d||"have-remote-offer"===d||"stable"===d){var g,h,i,j,k=-1;for(g=0;g<gb.length;g++)if(j=gb[g].fabricData,(b===j.pc||b.callstatsID===j.pc.callstatsID)&&o(b)){h=gb[g].confID,i=gb[g].remoteID,k=g,j.pcHash=l(j.pc),ha(h,i,j);break}-1!==k&&gb.splice(k,1)}}}},kc=function(a,b,c,d){null===a.statsInterval&&(a.statsPollingStart=g(),oc(b,c,d),a.statsInterval=setInterval(oc,cb.statsSubmissionIntervalInMS[cb.currentActivePhaseIndex],b,c,d))},lc=function(a){if(a){var b,c=$a.codebase;if(c===Ib.firefox)b=a.target;else if(c===Ib.chrome)b=a.srcElement;else{if(c!==Ib.edge)return void console.error("PeerConnection negotiation needed: unsupported code base");b=a.pc}if(void 0!==b){var d,e,f;for(d in bb)if(bb.hasOwnProperty(d))for(e in bb[d].participants)if(bb[d].participants.hasOwnProperty(e)&&bb[d].participants[e].containsKey(b)){f=bb[d].participants[e].get(b);break}null==f&&(f=hc(b)),null!=f&&f.numNegotiationNeededCalls++}}},mc=function(a){if(a){var b,c=$a.codebase;if(c===Ib.firefox)b=a.target;else if(c===Ib.chrome)b=a.srcElement;else{if(c!==Ib.edge)return void console.error("PeerConnection ICE connection state changed: unsupported code base");b=a.pc}if(void 0!==b){var d,e,f,h,i;for(d in bb)if(bb.hasOwnProperty(d))for(e in bb[d].participants)if(bb[d].participants.hasOwnProperty(e)&&bb[d].participants[e].containsKey(b)){f=bb[d].participants[e].get(b),h=g(),i=h-f.startTime,"complete"===b.iceGatheringState&&"checking"===b.iceConnectionState&&(f.gatheringIceCandidatesDelay=i),"connected"===b.iceConnectionState||"completed"===b.iceConnectionState?(f.connectivityIceStatusDelay=i,f.pcState===Ab.initializing?f.fabricSetupSent||_b(f.pc,pb.autoFabricSetup,d):f.pcState===Ab.disrupted&&_b(f.pc,pb.fabricDisrupted,d),f.pcState=Ab.established,kc(f,b,d,e)):"failed"===b.iceConnectionState?(f.setupFailureTime=i,_b(f.pc,pb.autoFabricSetupFailed,d),f.pcState=Ab.failed):"disconnected"===b.iceConnectionState&&(f.startTime=g(),f.pcState=Ab.disrupted,f.pcCallback&&f.pcCallback(rb.appConnectivityError,"Connectivity check for PC object to "+e+" failed.")),f.iceConnectionState=b.iceConnectionState;break}}}},nc=function(a){var b,c,d;if(null!==a.candidate){var e=a.candidate.candidate;c=e.split(" ");var f="1"===c[1]?"rtp":"rtcp";"0"!==c[5]&&(d=-1!==c[4].indexOf(":"),b={transport:c[2],protocol:f,typePreference:c[3],address:d?"["+c[4]+"]:"+c[5]:c[4]+":"+c[5],type:c[7],media:a.candidate.sdpMid})}var g,h=$a.codebase;if(h===Ib.firefox)g=a.target;else if(h===Ib.chrome)g=a.srcElement;else{if(h!==Ib.edge)return void console.error("PeerConnection ICE candidate found: unsupported code base");g=a.pc}if(void 0!==g){var i,j,k;for(i in bb)if(bb.hasOwnProperty(i))for(j in bb[i].participants)if(bb[i].participants.hasOwnProperty(j)&&bb[i].participants[j].containsKey(g))return k=bb[i].participants[j].get(g),void(void 0!==b&&-1===k.iceCandidates.indexOf(b)&&k.iceCandidates.push(b))}},oc=function(a,b,c){if(!bb.hasOwnProperty(b))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",b);if(!bb[b].participants.hasOwnProperty(c))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",c);if("closed"===a.signalingState)return _b(a,ob.fabricTerminated,b),!0;var d=bb[b].participants[c].get(a);if(d.pcState!==Ab.established&&d.lastFabricState===d.pcState)return!0;var e=$a.codebase,f=$a.name,h=bb[b].ucID;e===Ib.firefox||"Safari"===f?a.getStats(null,V(Ea,c,b,h,d,a,d.pcCallback),function(a){pc(Da,Ea,"log",{msg:"### "+e+" getStats reports error "+JSON.stringify(a)})}):e===Ib.chrome?a.getStats(V(Ea,c,b,h,d,a,d.pcCallback)):e===Ib.edge&&a.getStats().then(V(Ea,c,b,h,d,a,d.pcCallback))["catch"](function(a){pc(Da,Ea,"log",{msg:"### "+e+" getStats reports error "+JSON.stringify(a)})});var i,j=g(),k=j-d.statsPollingStart,l=5e3;(k>cb.statsSubmissionPhaseDurationInMS[cb.currentActivePhaseIndex]&&d.intervalAdaptionPhase||Ma===!0)&&(da(d.statsInterval),Ma?(i=Na,d.intervalAdaptionPhase=!1,Ma=!1):cb.currentActivePhaseIndex<cb.statsSubmissionIntervalInMS.length-1?(cb.currentActivePhaseIndex+=1,i=cb.statsSubmissionIntervalInMS[cb.currentActivePhaseIndex]):(i=Ua,d.intervalAdaptionPhase=!1),i>l&&(d.initialPhaseOver=!0),d.statsInterval=setInterval(oc,i,a,b,c))},pc=function(a,b,c,d){var e=za+"generics",f={appID:a,userID:encodeURIComponent(b),version:Ba,eventType:c,data:d};qc(e,JSON.stringify(f),function(a){200===a.status||200!==a.status})},qc=function(a,b,c){var d=new XMLHttpRequest;d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b)},rc=function(a,b,c,d){if(!(void 0===a||void 0===b||void 0===c||0>=a||0>c)){if(Ya)return void ra(d);Za&&(clearTimeout(Za),Za=null),Ya=!0;var e=za+"o/authorize",f={appID:a,userID:encodeURIComponent(c),version:Ba,authType:Ca};qc(e,JSON.stringify(f),function(e){var f;if(200===e.status)f=JSON.parse(e.response),void 0!==f.authorize.status&&f.authorize.status!==rb.ok?f.reason===sb.csProtoError&&(Ya=!1,qa(d)):pa(b,f.authorize.challenge,a,c,d);else if(200!==e.status&&(Ya=!1,502!==e.status&&0!==e.status&&500!==e.status||Za||(Za=setTimeout(function(){rc(a,b,c,d)},Xa)),void 0!==d)){var g;400===e.status?(g=e.responseText,d(rb.authError,g)):502===e.status||0===e.status||500===e.status?(g="HTTP "+e.status+", "+e.statusText+". Server temporarily unavailable. Retrying in "+Xa+"ms",d(rb.appConnectivityError,g)):(g="HTTP "+e.status+", "+e.statusText+". "+e.responseText,d(rb.httpError,g))}})}},sc=function(){oa(qb.clockSync,qb.clockSync,{userID:Ea},null)},tc=function(a,b){if(eb){var c=(b-db.syncStartTime)/2;if(c>db.maxAllowedLatency)db.offsetResults=[],pc(Da,Ea,"log",{msg:"clockSync restarting"});else{var d=a.now+c,e=d-b;db.offsetResults.push(e)}if(db.offsetResults.length>=db.syncAttempts){var f=db.offsetResults.reduce(function(a,b){return a+b});db.currentOffset=f/db.offsetResults.length,db.offsetResults=[],eb=!1,pc(Da,Ea,"log",{msg:"clockSync Done"})}else eb&&setTimeout(function(){sc()},100)}},uc=function(a,c){return Ra?(pc(Da,Ea,"log",{msg:"### _setupChannel is called when already connected!"}),void(c&&c(rb.success,"WebSocket establishment successful."))):Qa?void pc(Da,Ea,"log",{msg:"### _setupChannel is called when _connection is not null and not connected! Let's rely on auto reconnect!"}):(Qa=b.connect(a,{port:Aa,reconnect:!0,"reconnection delay":500,"max reconnection attempts":500,reconnectionDelayMax:8e3}),Qa.on("connect",function(){pc(Da,Ea,"log",{msg:"Successfully connected to the backend",io_ver:b.protocol}),Ra=!0,db.syncHandler||(pc(Da,Ea,"log",{msg:"start clockSync"}),db.offsetResults=[],sc(),db.syncHandler=!0),Pb(),Sa?fa():Yb(Qa),Sa=!1,c&&c(rb.success,"WebSocket establishment successful.")}),Qa.on("disconnect",function(){Ra=!1,ea(),c&&c(rb.httpError,"Connection to the server disappeared.")}),Qa.on("connect_failed",function(){Ra=!1,c&&c(rb.wsChannelFailure,"WebSocket establishment failed.")}),Qa.on("reconnect",function(){Sa=!0}),Qa.on("reconnect_failed",function(){Ra=!1}),void Qa.on("response",function(a){var b=g(),d=JSON.parse(a);if("Error"===d.status)"Invalid client token."===d.reason&&(Ha=null,rc(Da,Ga,Ea)),c&&c(rb.csProtoError,a.reason);else if("200 OK"===d.status)if("feedback"===d.event)window.localStorage.removeItem("feedback");else if(d.event===pb.userJoined||d.event===pb.refreshPresence){var e,f=!1,h=null,i=decodeURIComponent(d.conferenceID);for(e in bb)if(bb.hasOwnProperty(e)&&e===i){bb[e].ucID!==d.ucID&&(f=!0,la(e,d.ucID),h=d.conferenceCreationTS?d.conferenceCreationTS:d.conferenceDuration),d.event!==pb.userJoined||bb[e].refreshPresence||(bb[e].refreshPresence=setInterval(function(){Xb(i)},Wa),va()),bb[e].ucID=d.ucID;break}Zb(),Ob(f,h)}else d.event===qb.clockSync&&tc(d,b)}))};return h(),uc(za+Ta),ua(),{version:Ba,initialize:$b,fabricEvent:ob,addNewFabric:ec,sendFabricEvent:_b,sendUserFeedback:cc,associateMstWithUserID:dc,csError:rb,fabricUsage:ub,qualityRating:wb,webRTCFunctions:Bb,reportError:bc,reportUserIDChange:fc,userIDType:vb}};"function"==typeof define&&define.amd?define("callstats",["jquery","socketio","sha"],b):a.callstats=b}(this);
/**
 * @license jahashtable, a JavaScript implementation of a hash table. It creates a single constructor function called
 * Hashtable in the global scope.
 *
 * http://www.timdown.co.uk/jshashtable/
 * Copyright 2013 Tim Down.
 * Version: 3.0
 * Build date: 17 July 2013
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
var Hashtable=function(t){function n(t){return typeof t==p?t:""+t}function e(t){var r;return typeof t==p?t:typeof t.hashCode==y?(r=t.hashCode(),typeof r==p?r:e(r)):n(t)}function r(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])}function i(t,n){return t.equals(n)}function u(t,n){return typeof n.equals==y?n.equals(t):t===n}function o(n){return function(e){if(null===e)throw new Error("null is not a valid "+n);if(e===t)throw new Error(n+" must not be undefined")}}function s(t,n,e,r){this[0]=t,this.entries=[],this.addEntry(n,e),null!==r&&(this.getEqualityFunction=function(){return r})}function a(t){return function(n){for(var e,r=this.entries.length,i=this.getEqualityFunction(n);r--;)if(e=this.entries[r],i(n,e[0]))switch(t){case E:return!0;case K:return e;case q:return[r,e[1]]}return!1}}function l(t){return function(n){for(var e=n.length,r=0,i=this.entries,u=i.length;u>r;++r)n[e+r]=i[r][t]}}function f(t,n){for(var e,r=t.length;r--;)if(e=t[r],n===e[0])return r;return null}function h(t,n){var e=t[n];return e&&e instanceof s?e:null}function c(){var n=[],i={},u={replaceDuplicateKey:!0,hashCode:e,equals:null},o=arguments[0],a=arguments[1];a!==t?(u.hashCode=o,u.equals=a):o!==t&&r(u,o);var l=u.hashCode,c=u.equals;this.properties=u,this.put=function(t,e){g(t),d(e);var r,o,a=l(t),f=null;return r=h(i,a),r?(o=r.getEntryForKey(t),o?(u.replaceDuplicateKey&&(o[0]=t),f=o[1],o[1]=e):r.addEntry(t,e)):(r=new s(a,t,e,c),n.push(r),i[a]=r),f},this.get=function(t){g(t);var n=l(t),e=h(i,n);if(e){var r=e.getEntryForKey(t);if(r)return r[1]}return null},this.containsKey=function(t){g(t);var n=l(t),e=h(i,n);return e?e.containsKey(t):!1},this.containsValue=function(t){d(t);for(var e=n.length;e--;)if(n[e].containsValue(t))return!0;return!1},this.clear=function(){n.length=0,i={}},this.isEmpty=function(){return!n.length};var y=function(t){return function(){for(var e=[],r=n.length;r--;)n[r][t](e);return e}};this.keys=y("keys"),this.values=y("values"),this.entries=y("getEntries"),this.remove=function(t){g(t);var e,r=l(t),u=null,o=h(i,r);return o&&(u=o.removeEntryForKey(t),null!==u&&0==o.entries.length&&(e=f(n,r),n.splice(e,1),delete i[r])),u},this.size=function(){for(var t=0,e=n.length;e--;)t+=n[e].entries.length;return t}}var y="function",p="string",v="undefined";if(typeof encodeURIComponent==v||Array.prototype.splice===t||Object.prototype.hasOwnProperty===t)return null;var g=o("key"),d=o("value"),E=0,K=1,q=2;return s.prototype={getEqualityFunction:function(t){return typeof t.equals==y?i:u},getEntryForKey:a(K),getEntryAndIndexForKey:a(q),removeEntryForKey:function(t){var n=this.getEntryAndIndexForKey(t);return n?(this.entries.splice(n[0],1),n[1]):null},addEntry:function(t,n){this.entries.push([t,n])},keys:l(0),values:l(1),getEntries:function(t){for(var n=t.length,e=0,r=this.entries,i=r.length;i>e;++e)t[n+e]=r[e].slice(0)},containsKey:a(E),containsValue:function(t){for(var n=this.entries,e=n.length;e--;)if(t===n[e][1])return!0;return!1}},c.prototype={each:function(t){for(var n,e=this.entries(),r=e.length;r--;)n=e[r],t(n[0],n[1])},equals:function(t){var n,e,r,i=this.size();if(i==t.size()){for(n=this.keys();i--;)if(e=n[i],r=t.get(e),null===r||r!==this.get(e))return!1;return!0}return!1},putAll:function(t,n){for(var e,r,i,u,o=t.entries(),s=o.length,a=typeof n==y;s--;)e=o[s],r=e[0],i=e[1],a&&(u=this.get(r))&&(i=n(r,u,i)),this.put(r,i)},clone:function(){var t=new c(this.properties);return t.putAll(this),t}},c.prototype.toQueryString=function(){for(var t,e=this.entries(),r=e.length,i=[];r--;)t=e[r],i[r]=encodeURIComponent(n(t[0]))+"="+encodeURIComponent(n(t[1]));return i.join("&")},c}();
/*! callstats.js 2016-06-14 */
function detectBrowserInfo(){var a,b,c=navigator.userAgent,d=navigator.appName,e=navigator.appVersion,f=""+parseFloat(navigator.appVersion),g={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"};-1!==(a=c.indexOf("Opera"))?(d="Opera",f=c.substring(a+6),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("OPR"))?(d="Opera",f=c.substring(a+4),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("MSIE"))?(d="Microsoft Internet Explorer",f=c.substring(a+5),b=g.goog):-1!==(a=c.indexOf("Edge"))?(d=g.edge,f=c.substring(a+5),b=g.edge):-1!==(a=c.indexOf("Chrome"))?(d=g.goog,f=c.substring(a+7),b=g.goog):-1!==(a=c.indexOf("Safari"))?(d="Safari",f=c.substring(a+7),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("Firefox"))&&(d="Firefox",f=c.substring(a+8),b=g.moz);var h,i,j=null,k=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(h in k)if(i=k[h],i.r.test(c)){j=i.s;break}var l=null;switch(/Windows/.test(j)&&(l=/Windows (.*)/.exec(j)[1],j="Windows"),j){case"Mac OS X":l=/Mac OS X (10[\.\_\d]+)/.exec(c)[1];break;case"Android":l=/Android ([\.\_\d]+)/.exec(c)[1];break;case"iOS":l=/OS (\d+)_(\d+)_?(\d+)?/.exec(e),l=l[1]+"."+l[2]+"."+(0|l[3])}return{name:d,ver:f.toString(),os:j+" "+l,codebase:b}}
/*! callstats.js 2016-06-14 */
function measureAppLoadingPerformance(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0}